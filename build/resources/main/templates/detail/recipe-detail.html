<!doctype html>
<html lang="ko">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head th:fragment="head" th:replace="~{common/layout :: head}"></head>

<head>


  <meta charset="utf-8" />
  <title>smore | recipe-detail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content=" " />
  <meta name="keywords" content="" />
  <meta content="Themesdesign" name="author" />

  <!-- App favicon -->
  <link rel="shortcut icon" th:href="@{/images/favicon.ico}">

  <!-- Choise Css -->
  <link rel="stylesheet" th:href="@{/libs/choices.js/public/assets/styles/choices.min.css}">

  <!-- Light Box Css -->
  <link rel="stylesheet" th:href="@{/libs/glightbox/css/glightbox.min.css}">

  <!-- Bootstrap Css -->
  <link th:href="@{/css/bootstrap.min.css}" id="bootstrap-style" rel="stylesheet" type="text/css" />
  <!-- Icons Css -->
  <link th:href="@{/css/icons.min.css}" rel="stylesheet" type="text/css" />
  <!-- App Css-->
  <link th:href="@{/css/app.min.css}" id="app-style" rel="stylesheet" type="text/css" />
  <!--Custom Css-->
  <link th:href="@{/css/receipe-detail.css}" id="app-style" rel="stylesheet" type="text/css" />
  <!--recipe-detail Css-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>

<body>
<header th:replace="~{common/layout :: #header}"></header>

  <!--start page Loader -->
  <div id="preloader">
    <div id="status">
      <ul>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </div>
  </div>
  <!--end page Loader -->
  

  <div class="main-content">

    <div class="page-content">

      <!-- Start home -->
      <section class="page-title-box" style="background-image: linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5) ), url(/images/img/hero_recipe-detail.jpg); height: 350px; padding-top: 130px; background-position: center;">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-md-6">
              <div class="text-center text-white">
                <h3 class="mb-4 hero-title" style="font-weight: 400;">레시피</h3>
                <div class="page-next">
                  <nav class="d-inline-block" aria-label="breadcrumb text-center">
                    <ol class="breadcrumb justify-content-center">
                      <li class="breadcrumb-item"><a th:href="@{/}">HOME</a></li>
                      <li class="breadcrumb-item"><a th:href="@{/recipe}">LIFE</a></li>
                      <li class="breadcrumb-item"><a th:href="@{/recipe}">RECIPE</a></li>
                      <li class="breadcrumb-item active" aria-current="page"> RECIPE DETAIL </li>
                    </ol>
                  </nav>
                </div>
              </div>
            </div>
            <!--end col-->
          </div>
          <!--end row-->
        </div>
        <!--end container-->
      </section>
      <!-- end home -->

      <!-- START SHAPE -->
      <div class="position-relative" style="z-index: 1">
        <div class="shape">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 250">
            <path fill="#FFFFFF" fill-opacity="1"
              d="M0,192L120,202.7C240,213,480,235,720,234.7C960,235,1200,213,1320,202.7L1440,192L1440,320L1320,320C1200,320,960,320,720,320C480,320,240,320,120,320L0,320Z">
            </path>
          </svg>
        </div>
      </div>
      <!-- END SHAPE -->

      <!-- START CANDIDATE-DETAILS -->
      <section class="section">
        <div class="container">
          <div class="text-center my-5">
            <p class="text-primary" >[[${recipe.rcpPat2}]] • [[${recipe.rcpWay2}]]</p>
            <h2>[[${recipe.rcpNm}]]</h2>
          </div>
          <hr>
          <div class="row">
            <div class="col">
              <div class="mt-4 mt-lg-0">
                <div class="p-4 candidate-personal-detail">
                  <div> <!--재료 시작-->
                    <h4 class="fw-semibold mb-3">재료</h4>
                    <p class="text-muted mb-2">[[${recipe.rcpPartsDtls}]]</p>
                  </div> <!--재료 끝-->
                  <div class="candidate-portfolio mt-5 pt-3"> <!--조리방법 시작-->
                    <h4 class="fw-semibold mb-0">조리방법</h4>
                    <div class="row">
                    
                      <!--조리방법 백엔드 시작-->
                      <th:block th:if="${recipe.manual01} != null">
                      <div class="col-lg-4 mt-4 mb-3">
                        <div class="candidate-portfolio-box card border-0" style="pointer-events: none;">
                          <img th:src="${recipe.manualImg01}" class="img-fluid rounded-3">
                          <p class="text-muted mb-2 mt-2">[[${recipe.manual01}]]</p>
                        </div>
                      </div>
                      <th:block>
                      <th:block th:if="${recipe.manual02} != null">
                      <div class="col-lg-4 mt-4 mb-3">
                        <div class="candidate-portfolio-box card border-0" style="pointer-events: none;">
                          <img th:src="${recipe.manualImg02}" class="img-fluid rounded-3">
                          <p class="text-muted mb-2 mt-2">[[${recipe.manual02}]]</p>
                        </div>
                      </div>
                      <th:block>
                      <th:block th:if="${recipe.manual03} != null">
                      <div class="col-lg-4 mt-4 mb-3">
                        <div class="candidate-portfolio-box card border-0" style="pointer-events: none;">
                          <img th:src="${recipe.manualImg03}" class="img-fluid rounded-3">
                          <p class="text-muted mb-2 mt-2">[[${recipe.manual03}]]</p>
                        </div>
                      </div>
                      <th:block>
                      <th:block th:if="${recipe.manual04} != null">
                      <div class="col-lg-4 mt-4 mb-3"> 
                        <div class="candidate-portfolio-box card border-0" style="pointer-events: none;">
                          <img th:src="${recipe.manualImg04}" class="img-fluid rounded-3">
                          <p class="text-muted mb-2 mt-2">[[${recipe.manual04}]]</p>
                        </div>
                      </div>
                      <th:block>
                      <th:block th:if="${recipe.manual05} != null">
                      <div class="col-lg-4 mt-4 mb-3">
                        <div class="candidate-portfolio-box card border-0" style="pointer-events: none;">
                          <img th:src="${recipe.manualImg05}" class="img-fluid rounded-3">
                          <p class="text-muted mb-2 mt-2">[[${recipe.manual05}]]</p>
                        </div>
                      </div>
                      <th:block>
                      <th:block th:if="${recipe.manual06} != null">
                      <div class="col-lg-4 mt-4 mb-3">
                        <div class="candidate-portfolio-box card border-0" style="pointer-events: none;">
                          <img th:src="${recipe.manualImg06}" class="img-fluid rounded-3">
                          <p class="text-muted mb-2 mt-2">[[${recipe.manual06}]]</p>
                        </div>
                      </div>
                      <th:block>
                      
                      <!--조리방법 백엔드 끝-->
                      
                    </div>
                  </div><!--end candidate-portfolio-->
                  <div class="candidate-portfolio mt-4 pt-3">
                    <div class="row">
                      <h4 class="fw-semibold mb-0">완성</h4>
                      <div class="col-lg-5 mt-4">
                        <div class="border-0">
                          <img th:src="${recipe.attFileNoMain}" class="img-fluid rounded-3"
                            style="width: 400px; height: 360px;">
                        </div>
                      </div>
                      <div class="card-body card col-lg-7 mt-4 m-auto" style="height: 360px;">
                        <div class="row">
                          <h5 class="col-lg-12 px-4 py-1 mb-4 fw-semibold">영양성분</h5>
                          <div class="col-lg-12 mb-3 px-4 border-bottom">
                            <p class="d-inline">열량</p>
                            <p class="d-inline float-end">[[${recipe.infoEng}]] kcal</p>
                          </div>
                          <div class="col-lg-12 mb-3 px-4 border-bottom">
                            <p class="d-inline">탄수화물</p>
                            <p class="d-inline float-end">[[${recipe.infoCar}]]g</p>
                          </div>
                          <div class="col-lg-12 mb-3 px-4 border-bottom">
                            <p class="d-inline">단백질</p>
                            <p class="d-inline float-end">[[${recipe.infoPro}]]g</p>
                          </div>
                          <div class="col-lg-12 mb-3 px-4 border-bottom">
                            <p class="d-inline">지방</p>
                            <p class="d-inline float-end">[[${recipe.infoFat}]]g</p>
                          </div>
                          <div class="col-lg-12 px-4">
                            <p class="d-inline">나트륨</p>
                            <p class="d-inline float-end">[[${recipe.infoNa}]]mg</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <th:block th:if="${session.loginMember != null}">
                  <!-- 좋아요, 스크랩 시작 -->
				<div class="col-lg-12 text-center mt-5">
                	<a th:id="|clip${recipe.rcpNo}|" th:value="${recipe.isClip}" th:onclick="|onClip(${recipe.rcpNo});|"
  					class="heart btn btn-clip" name="clip">
  						<i class="uil uil-bookmark-full ms-1"></i> 스크랩
  					</a>
                     <a th:id="|like${recipe.rcpNo}|" th:value="${recipe.isLike}" th:onclick="|onLike(${recipe.rcpNo});|"
  					class="heart btn btn-clip" name="like">
  						<i class="uil uil-thumbs-up ms-1"></i> 좋아요 [[${recipe.likeCount}]]
  					</a>
             	</div>
                  <!-- 좋아요, 스크랩 끝 -->
                  </th:block>
                  
                  <!--댓글부 시작-->
                  <div class="mt-5">
                    <h4 class="border-bottom pb-3">댓글</h4>
                    <div class="row mt-3">
                    <!--댓글 백엔드 시작-->
                    <th:block th:if="${!#lists.isEmpty(replyList)}">
                    	<th:block  th:each="reply : ${replyList}"> 
		                    <div class="col-lg-9 d-sm-flex align-items-top mt-4">
		                      <div class="flex-shrink-0">
		                        <img class="rounded-circle avatar-md img-thumbnail" th:src="@{/images/user/avatar2.png}"
		                          alt="img">
		                      </div>
		                      <div class="flex-grow-1 ms-sm-3">
	                        	  <h6 class="fs-16 mt-sm-0 mt-3 mb-0" >[[${reply.writer}]]</h6>
		                          <p class="text-muted fs-14 mb-0 mb-2">[[${#dates.format(reply.modifyDate, "yyyy-MM-dd HH:mm")}]]</p>
		                          <p class="mb-0" th:id="|content${reply.rcprNo}|">[[${reply.content}]]</p>
		                      </div>
		                    </div>
	                          <th:block th:if="${session.loginMember != null && 
								(session.loginMember.id == reply.writer || session.loginMember.role == 'ROLE_ADMIN')}">
	                         	<div class="col-lg-3 text-end mt-3">
	                            	<button name="update" th:id="|updateBtn${reply.rcprNo}|" class="btn btn-outline-primary" style="padding: 5px 10px;"
	                            	th:onclick="|updateReply(${reply.rcprNo})|">수정</button>
	                            	<button name="delete" class="btn btn-outline-danger" style="padding: 5px 10px;"
	                            	th:onclick="|deleteReply(${reply.rcprNo},${recipe.rcpNo});|">삭제</button>
	                          	</div>
	                          </th:block>
	                          <div class="mt-1 pt-3 mb-3 updateReply" th:id="|updateReply${reply.rcprNo}|" style="display: none">
                        		<div class="row">
				                  <div class="col-lg-12">
				                    <div class="mb-3">
				                      <input type="hidden" name="rcpNo" th:value="${recipe.rcpNo}" />
				                      <textarea class="form-control" th:id="|inputReply${reply.rcprNo}|" name="content" rows="3"
				                        placeholder="내용을 입력해주세요." required>[[${reply.content}]]</textarea>
				                    </div>
				                  </div><!--end col-->
				                </div><!--end row-->
				                <div class="text-end">
				                  <button type="submit" id="submit" class="btn btn-outline-primary" style="padding: 5px 10px;"
				                  th:onclick="|updBtn(${reply.rcprNo}, ${recipe.rcpNo})|">확인</button>
				                  <button id="submit" class="btn btn-outline-secondary" style="padding: 5px 10px;"
				                  th:onclick="|backBtn(${reply.rcprNo})|">취소</button>
				                </div>
	                          </div><!-- updateReply -->
		                      </div>
		                    </div>
		            	</th:block>   
                    </th:block>
                    <th:block th:if="${#lists.isEmpty(replyList)}">
					  <div>
				        <p>등록된 댓글이 없습니다.</p>
					  </div>
				    </th:block>
                    </div>
                    <!--댓글 백엔드 끝-->
                  </div>
                  <th:block th:if="${session.loginMember != null}">
                  <form th:action="@{recipe/reply}" method="post" class="mt-5 pt-3 mb-3"> <!--댓글 폼 시작-->
                    <div class="row">
                      <div class="col-lg-12">
                        <div class="mb-3">
                          <input type="hidden" name="rcpNo" th:value="${recipe.rcpNo}" />
                          <h6 class="my-1 mx-3" style="margin-bottom: -2rem !important;" th:text="${session.loginMember.id}"></h6>
                          <textarea class="form-control" id="inputcoment" name="content" rows="3" style="padding: 2rem 0 0 0.9rem !important;" 
                            placeholder="댓글을 남겨보세요." required></textarea>
                        </div>
                      </div><!--end col-->
                    </div><!--end row-->
                    <div class="text-end">
                      <button name="submit" type="submit" id="submit" class="btn btn-primary btn-hover">등록하기 <i
                        class="uil uil-message ms-1"></i></button>
                    </div>
                  </form> <!--댓글 폼 끝-->
                   </th:block>
                  <!--댓글 백엔드 끝-->

                </div><!--end card-body-->
              </div><!--end card-->
            </div><!--end col-->
          </div><!--end row-->
        </div><!--end container-->
      </section>
      <!-- END CANDIDATE-DETAILS -->

    </div>
    <!-- End Page-content -->

    <!-- Style switcher -->
  <div id="style-switcher" onclick="toggleSwitcher()" style="left: -165px;">
    <div>
      <div class="mt-3">
        <div class="text-center mt-3">
          <!-- light-dark mode -->
          <a href="javascript: void(0);" id="mode" class="mode-btn text-white rounded-3">
            <i class="uil uil-brightness mode-dark mx-auto"></i>
            <i class="uil uil-moon mode-light"></i>
          </a>
          <!-- END light-dark Mode -->
        </div>
      </div>
    </div>
    <div class="bottom d-none d-md-block">
    </div>
  </div>
  <!-- end switcher-->

  <!--start back-to-top-->
  <button onclick="topFunction()" id="back-to-top">
    <i class="mdi mdi-arrow-up"></i>
  </button>
  <!--end back-to-top-->
  </div>
  <!-- end main content-->

  </div>
  <!-- END layout-wrapper -->
  
  <script type="text/javascript">
  	function deleteReply(rcprNo, rcpNo){
			var url = "/recipe/replyDel?rcprNo=";
			var requestURL = url + rcprNo +"&rcpNo=" + rcpNo;
			location.replace(requestURL);
	}
  	
  	function updateReply(rcprNo){
  		var updateBtn = document.getElementById("updateBtn" + rcprNo);
  		updateBtn.style.display = "none";
  		
  		var content = document.getElementById("content" + rcprNo);
  		content.style.display = "none";
  		
  		var updateForm = document.getElementById("updateReply" +rcprNo);
  		updateForm.style.display = "inline-block";
  	}
  	
  	function updBtn(rcprNo, rcpNo){
  		var newContent = document.getElementById("inputReply" + rcprNo).value;
  		if(newContent.trim() === ''){
  			alert("내용을 입력해주세요.")
  			return;
  		}
  		
  		var requestURL = '/recipe/updateReply?rcprNo=' + rcprNo +'&content=' + newContent + '&rcpNo=' + rcpNo;
  		location.replace(requestURL);
  	}
  	
  	function backBtn(rcprNo){
  		var updateBtn = document.getElementById("updateBtn" + rcprNo);
  		updateBtn.style.display = "inline-block";
  		
  		var content = document.getElementById("content" + rcprNo);
  		content.style.display = "inline-block";
  		
  		var updateForm = document.getElementById("updateReply" +rcprNo);
  		updateForm.style.display = "none";
  	}
  	
  	$(function(){
  		// 스크랩 초기화
  		var clipItem = document.getElementsByName('clip')[0];
  		var clipValue = JSON.parse(clipItem.getAttribute('value'));
  		
  		if(clipValue === 1){
  			$("[name='clip']").css({"background-color":"#f7cc53", "color" : "#fff"});
      	  	$("[name='clip']").children("i").css({"background-color":"#f7cc53", "color" : "#fff"});
  		}
  		
  		var likeItem = document.getElementsByName('like')[0];
  		var likeValue = JSON.parse(likeItem.getAttribute('value'));
  		
  		if(likeValue === 1){
  			$("[name='like']").css({"background-color":"#f7cc53", "color" : "#fff"});
      	  	$("[name='like']").children("i").css({"background-color":"#f7cc53", "color" : "#fff"});
  		}		
  	});
  	
  	
  	function onClip(rcpNo){
 		var id = 'clip' + rcpNo;
  		var value = document.getElementById(id).getAttribute('value');
        if(value == 0){
        	value = 1;
        }else{
        	value = 0;
        }
        // 여기에 AJAX로 DB 업데이트하는 코드 있어야함!!
        $.ajax({
			method:'get',
			url:'/recipe/clip?rcpNo=' + rcpNo +'&isClip=' + value,
			contentType: 'application/json',
			dataType : 'json',
			success: (result) =>{
				$('#'+id).attr('value', ''+result);
		        if(result === 1){
		        	$("[name='clip']").css({"background-color":"#f7cc53", "color" : "#fff"});
		      	  	$("[name='clip']").children("i").css({"background-color":"#f7cc53", "color" : "#fff"});
		        }else{
		        	$("[name='clip']").css({"background-color":"rgba(247, 204, 83, 0.15)", "color" : "#f7cc53"});
		      	  	$("[name='clip']").children("i").css({"background-color":"rgba(247, 204, 83, 0.15)", "color" : "#f7cc53"});
		        }
			},
			error : (e) => {
				alert('전송 실패!!');
			}
		});
    }
  	
  	function onLike(rcpNo){
 		var id = 'like' + rcpNo;
  		var value = document.getElementById(id).getAttribute('value');
        if(value == 0){
        	value = 1;
        }else{
        	value = 0;
        }
        // 여기에 AJAX로 DB 업데이트하는 코드 있어야함!!
        $.ajax({
			method:'get',
			url:'/recipe/like?rcpNo=' + rcpNo +'&isLike=' + value,
			contentType: 'application/json',
			dataType : 'json',
			success: (result) =>{
				$('#'+id).attr('value', ''+result[0]);
				$('#'+id).html('<i class="uil uil-thumbs-up ms-1"></i> 좋아요 ' + result[1]);
		        if(result[0] == 1){
		        	$('#'+id).css({"background-color":"#f7cc53", "color" : "#fff"});
		      	  	$('#'+id).children("i").css({"background-color":"#f7cc53", "color" : "#fff"});
		        }else{
		        	$('#'+id).css({"background-color":"rgba(247, 204, 83, 0.15)", "color" : "#f7cc53"});
		      	  	$('#'+id).children("i").css({"background-color":"rgba(247, 204, 83, 0.15)", "color" : "#f7cc53"});
		        }
			},
			error : (e) => {
				alert('전송 실패!!');
			}
		});
    }
  	
  	
  </script>
  
  <footer th:replace="~{common/layout :: #footer}"></footer>

  <!-- JAVASCRIPT -->
  <script th:src="@{/libs/bootstrap/js/bootstrap.bundle.min.js}"></script>
  <script src="https://unicons.iconscout.com/release/v4.0.0/script/monochrome/bundle.js"></script>


  <!-- Choice Js -->
  <script th:src="@{/libs/choices.js/public/assets/scripts/choices.min.js}"></script>

  <!-- Light Box Js -->
  <script th:src="@{/libs/glightbox/js/glightbox.min.js}"></script>

  <script th:src="@{/js/pages/lightbox.init.js}"></script>

  <!-- Switcher Js -->
  <script th:src="@{/js/pages/switcher.init.js}"></script>

  <script th:src="@{/js/app.js}"></script>

</body>

</html>